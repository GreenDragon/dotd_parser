{{extend 'layout.html'}}

<script>
$(document).ready(function() {
    $("#sharedRaids").dataTable( {
        "paging":  false,
        "info":    false,
        "order":   [[2, "desc" ]],
    } );
} );
</script>

<script>
$(function() {
    $('[data-toggle="tooltip"]').tooltip();
});
</script>

{{if len(rows):}}
<h3 class="bg-danger">Deprecation Warning! LoTS Last Days!</h3>
<h3 class="bg-danger">LoTS Shared Raid Caching Service Will Be Removed On 2016/02/29!</h3>

<h4>Found {{=len(rows)}} active shared raids for the LoTS {{=str(rows[0].platform).capitalize()}} Server.</h4>

<h6>Shared Raid Information is updated every 10 minutes. This utility shows all active raids ordered by Create Date ( UTC Time ) Descending since last scan ( max 500 ).</h6>
<h6>Clicking on Table Headers will change the sort order. Typing text in the Search field will filter results. Click the Raid Name to Join.</h6>

<div class="table">
<table id="sharedRaids" class="display table table-borderd">
  <thead>
    <tr>
      <th>Shared Raid Boss</th>
      <th>Difficulty</th>
      <th>Created</th>
      <th>Updated</th>
      <th>Health</th>
      <th>Members</th>
      <th>Team Max</th>
      <th>Tactics</th>
    </tr>
  </thead>
  <tbody>
    {{for row in rows:}}
      {{if not len(row.raid_boss_human):}}
        {{row.raid_boss_human = row.raid_boss}}
      {{pass}}
    <tr>
      <td><a href="{{=gen_lots_raid_url(row.link_name, row.raid_id, row.difficulty, row.raid_boss, row.raid_hash, row.platform)}}" target="_blank" data-toggle="tooltip" title="Click to Join the LoTS {{=str(row.platform).capitalize()}} Shared Raid">{{=row.raid_boss_human}}</a></td>
      <td><a href="{{=gen_short_raid_link(row.raid_id, row.raid_hash)}}" target="_blank" data-toggle="tooltip" title="Right Click Copy for Short Raid Paste Code">{{=difficultize(row.difficulty)}}</a></td>
      <td>{{=row.create_time.strftime('%m/%d %H:%M:%S')}}</td>
      <td>{{=row.update_time.strftime('%m/%d %H:%M:%S')}}</td>
      <td>{{=lots_percentage(row.currenthealth, row.maxhealth)}} %</td>
      <td>{{=row.nummembers}}</td>
      <td>{{=row.maxattackers}}</td>
      <td>{{=XML(gen_tactics_url(row, tactics_map))}}</td>
    </tr>
    {{pass}}
  </tbody>
</table>
</div>
{{else:}}
<p>No active raids found, please check back later. System is updated every 15-20 minutes...</p>
{{pass}}

